#pragma once

#include <array>

constexpr int INPUT_SIZE = 23;
constexpr int L2_SIZE = 16;
constexpr int L3_SIZE = 1;

constexpr std::array<float, INPUT_SIZE *L2_SIZE> input_weights = {
    0.1436,  0.2370,  0.9723,  0.6274,  -0.1136, 0.0007,  -0.3404, 0.0854,  0.1239,  1.1372,  -0.1385, -1.3718, -0.0160,
    0.0022,  -0.0811, 0.0690,  -0.2890, 0.0616,  0.1324,  -0.0838, -0.0950, 0.0753,  0.2281,  0.1298,  0.2607,  0.3763,
    -0.1496, -0.5139, -0.0351, 0.0399,  0.0390,  0.2490,  0.2394,  -0.3057, -0.1234, -0.0405, 0.0147,  -0.0387, 0.0787,
    -0.7122, 0.0964,  -0.9467, -0.1292, -0.2323, -1.2181, 0.6825,  0.0550,  0.1715,  0.2424,  0.9095,  -0.1661, -0.0122,
    0.2451,  0.0284,  0.1123,  -0.8670, -0.1261, -0.2113, 0.1649,  -0.0128, -0.1213, 0.1944,  -0.2940, 0.0108,  0.0099,
    -0.0647, -0.0968, 0.0371,  0.1764,  0.1758,  0.0033,  -0.4321, -0.5381, -0.0343, 0.0003,  -0.0869, -0.0412, -0.0605,
    -0.0179, 0.0640,  0.4862,  -0.5574, 0.0225,  0.0593,  -0.0402, 0.3216,  0.0105,  -0.0299, -0.0171, -0.2923, 0.4701,
    -0.0904, -1.3405, 0.2207,  0.1845,  -0.1418, -0.4375, -0.0044, 0.3132,  0.0404,  0.2317,  0.0983,  -0.2728, -0.2223,
    -0.2064, 0.0053,  -0.0023, 0.0434,  -0.6860, 0.0381,  -0.0046, -0.0743, -0.1106, 0.0540,  0.5467,  0.2329,  0.0952,
    0.4708,  -0.7702, -0.0145, -0.0035, -0.4245, 0.1060,  -0.0051, 0.0498,  -0.0681, -0.9999, 0.1545,  0.0254,  0.0106,
    0.0109,  -0.3974, 0.0884,  -0.5121, 0.0182,  0.0730,  -0.3195, -0.3697, 0.2877,  -0.7067, 0.8160,  -0.0141, 0.0410,
    0.0234,  -0.6986, -0.0563, -0.0141, -0.0311, -0.0113, 0.7820,  0.1188,  0.0057,  0.0265,  -0.0314, -0.0148, -0.0045,
    -0.2016, -0.0016, -0.0004, 0.0248,  0.0161,  0.4713,  -0.1128, 1.8790,  0.6742,  -0.4078, 0.0214,  0.4121,  -0.1542,
    0.0688,  1.3153,  -0.1223, 0.2248,  0.3276,  -0.0076, -0.0879, 0.1568,  -0.1246, -0.0274, -0.0254, -0.0834, -0.2681,
    -0.0196, 0.0727,  0.2058,  0.0443,  -0.4579, -0.5855, 0.0182,  0.0227,  -0.0620, 0.2190,  0.0309,  -0.1805, 0.0616,
    -1.1465, -0.6723, -0.0039, -0.0930, -0.7040, 0.2343,  0.0691,  -0.4003, 0.0343,  -0.0210, -0.0798, -0.3321, 0.0280,
    0.0507,  0.0306,  -0.7325, -0.2579, 0.0006,  0.5533,  0.8539,  0.1445,  0.4039,  -0.0729, -1.8567, -0.3414, 0.0008,
    -0.1094, 0.2767,  -0.1737, 0.1299,  -0.0902, 0.0017,  0.3968,  0.0800,  0.1443,  0.2000,  0.0895,  0.4585,  1.0674,
    0.0344,  -0.0154, -0.2704, -0.0139, -0.0370, -0.3517, 0.0122,  0.4091,  -0.0084, -0.0030, 0.0001,  0.0608,  -0.1097,
    -0.0267, 0.0770,  -0.0195, -0.1426, -0.0802, -0.0626, 0.0552,  0.1178,  0.2353,  -1.5752, -0.2282, -0.0111, 0.1156,
    0.0354,  0.1530,  0.0761,  -0.1468, -0.0368, 0.2075,  -0.0082, 0.1206,  -0.1481, -0.7024, 0.0070,  -0.0509, -0.0013,
    -0.2650, -0.4904, 0.3548,  -0.4995, 0.1158,  -0.1106, -0.6498, 0.5159,  -0.0354, -0.0532, 0.0569,  -0.0418, -0.0490,
    0.0781,  0.3300,  0.1699,  0.0274,  0.1148,  -0.1665, 0.1358,  -0.0032, -0.0874, 0.0916,  0.0499,  0.4109,  -0.0107,
    0.2420,  0.0394,  1.0488,  -1.3327, 0.0271,  0.0026,  -0.4184, 0.0962,  -0.0512, 0.0839,  0.0276,  0.2444,  -0.6836,
    0.0165,  0.1094,  -0.0618, -0.3032, 0.0185,  -0.0048, 0.0900,  -0.1396, -0.3033, -0.1569, 0.1943,  -0.0524, 0.0301,
    -0.5475, 0.4922,  -0.0078, -0.6349, -0.1463, -0.1973, 0.0183,  0.1951,  -2.3312, -0.5433, 0.0285,  0.3229,  -0.0457,
    0.1328,  0.1466,  -0.2848, 0.1331,  0.0983,  0.2513,  -0.0533, -0.0037, 0.0873,  -0.1755, 0.3764,  -0.0187, -0.0065,
    -0.4592, 0.0048,  -0.0026, -0.0201, -0.0167, 0.6944,  -0.2706, 0.0023,  1.5978,  -0.0895, -0.0845, -0.0027, -0.0211,
    -0.0033, -0.0117, -0.1660, -0.1144};

constexpr std::array<float, L2_SIZE> input_biases = {0.4994,  1.1351,  -0.9632, -1.3727, -0.8704, 0.4893,
                                                     -0.4790, -0.4204, -0.0390, -0.4564, 0.2575,  0.3674,
                                                     -0.1465, -0.1711, 0.8324,  -1.5362};

constexpr std::array<float, L2_SIZE> l2_weights = {0.8394,  0.6712,  1.4539, -1.8371, -1.6456, 0.5006,
                                                   -1.1203, 0.6533,  0.2481, 0.3521,  -0.7997, 0.8101,
                                                   -0.5841, -1.0777, 0.6066, -2.6215};

constexpr float l2_bias = 0.3019;

constexpr std::array<float, INPUT_SIZE> means = {
    5.452467080606962,   7.112796656718116,    0.8578524521488929,  0.2580247593890559, 0.3140062440636067,
    0.3301769348864686,  0.038723504354787004, 0.820671299053199,   0.1572143583836538, 5.921183065777163,
    21.84792463987609,   1166.1757456820978,   1167.0037809233131,  732.9955358915151,  -19.418957825610615,
    0.5227610872420946,  -1503.2052281145216,  -2.0642034078674727, 126.43629579725577, 0.043985748508458045,
    0.15268151661182816, 0.02280523060314052,  0.3006139186091227};

constexpr std::array<float, INPUT_SIZE> stddevs = {
    2.856556473540784,   6.308056910658986,   0.3492014067712561, 0.43754769217912187, 0.6693623705907236,
    0.47027664895829696, 0.1929352082054279,  0.3836273164981005, 0.36400275260177606, 0.9771860382278457,
    25.544261692591324,  6194.445366321299,   6196.782098044113,  7325.809065093816,   43.69528704433516,
    0.49948166423559315, 9047.625746073467,   214.0488170007344,  2000.5239829554266,  0.20506341076995852,
    0.35968023450968256, 0.14928212237330396, 0.4585250162723845};

class LMRNet
{
  public:
    LMRNet() = default;

    int predict(const std::array<int, INPUT_SIZE> &input)
    {
        float result = l2_bias;

        std::array<float, INPUT_SIZE> scaled;
        for (int i = 0; i < INPUT_SIZE; ++i)
        {
            scaled[i] = 1.0f * (input[i] - means[i]) / stddevs[i];
        }

        for (int i = 0; i < L2_SIZE; ++i)
        {
            output[i] = 0.0f;
            for (int j = 0; j < INPUT_SIZE; ++j)
            {
                output[i] += scaled[j] * input_weights[i * INPUT_SIZE + j];
            }
            output[i] += input_biases[i];
            output[i] = std::max(0.0f, output[i]);
        }

        for (int i = 0; i < L2_SIZE; ++i)
        {
            result += output[i] * l2_weights[i];
        }
        return result;
    }

    std::array<float, L2_SIZE> output;
};